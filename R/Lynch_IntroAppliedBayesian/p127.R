#MH algorithm for sampling parameters from the bivariate normal density

xx<-matrix(NA,2,1377)
xx[,1:361]=c(1,1); xx[,362:448]=c(1,2); xx[,449:487]=c(1,3);
xx[,488:495]=c(1,4); xx[,496:497]=c(1,5); xx[,498:499]=c(1,6);
xx[,500:608]=c(2,1); xx[,609:801]=c(2,2); xx[,802:852]=c(2,3);
xx[,853:865]=c(2,4); xx[,866:867]=c(2,5); xx[,868:870]=c(2,6);
xx[,871:915]=c(3,1); xx[,916:1006]=c(3,2); xx[,1007:1190]=c(3,3);
xx[,1191:1215]=c(3,4); xx[,1216:1219]=c(3,5); xx[,1220:1224]=c(3,6);
xx[,1225:1239]=c(4,1); xx[,1240:1256]=c(4,2); xx[,1257:1291]=c(4,3);
xx[,1292:1308]=c(4,4); xx[,1309:1312]=c(4,5); xx[,1313:1314]=c(4,6);
xx[,1315:1324]=c(5,1); xx[,1325:1328]=c(5,2); xx[,1329:1337]=c(5,3);
xx[,1338:1342]=c(5,4); xx[,1343:1344]=c(5,5); xx[,1345:1355]=c(6,1);
xx[,1356:1364]=c(6,2); xx[,1365:1368]=c(6,3); xx[,1369:1371]=c(6,4);
xx[,1372:1372]=c(6,5); xx[,1373:1377]=c(6,6);
d=t(xx)

m=matrix(0,10000,2)
s=array(1,dim=c(5000,2,2)); s[,1,2]=s[,2,1]=0
sc<-matrix(0,2,2)
corr<-matrix(0,5000)
e<-d
mn=matrix(c(mean(d[,1]),mean(d[,2])),2)

for(i in 2:10000)
{
 #simulate m
 u=rnorm(2,mean=0,sd=1)
 m[i,]=t(mn) + t(u)%*%chol(s[i-1,,]/1377)

 #simulate s
 e[,1]=d[,1]-m[i,1]; e[,2]=d[,2]-m[i,2]

 sc<-t(e)%*%(e)
 s[i,,]<-riwish(1377,sc)

 corr[i]=s[i,1,2]/sqrt(s[i,1,1]*s[i,2,2])

 if(i%%100==0){print(c(i,corr[i]))}
}

